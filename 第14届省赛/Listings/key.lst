C51 COMPILER V9.60.0.0   KEY                                                               05/11/2023 22:29:08 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE KEY
OBJECT MODULE PLACED IN .\Objects\key.obj
COMPILER INVOKED BY: E:\keil5\keil5\C51\BIN\C51.EXE Driver\key.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\User;.\Config;.\Drive
                    -r;.\System) DEBUG OBJECTEXTEND PRINT(.\Listings\key.lst) OBJECT(.\Objects\key.obj)

line level    source

   1          #include "key.h"
   2          
   3          
   4          
   5          //æŒ‰é”®æ˜ å°„è¡¨
   6          unsigned char code Key_Map[2][2] = {
   7                  {'5','9'},
   8                  {'4','8'}
   9          };
  10          
  11          //æŒ‰é”®çŠ¶æ€è¡¨
  12          unsigned char Key_Sta[2][2] = {
  13                  {1,1},{1,1}
  14          };
  15          
  16          
  17          unsigned char MenuModeSelect_S4 = 0;    //èœå•æ¨¡å¼é€‰æ‹©
  18          unsigned char BackupMenuChange_S5 = 0;  //å›æ˜¾èœå•é€‰æ‹©
  19          
  20          unsigned int Parm_Temp = 300;           //æ¸©åº¦å‚æ•°
  21          unsigned int Parm_Temp_Buf = 300;       //æ¸©åº¦å‚æ•°ç¼“å­˜
  22          
  23          bit flag_Long_Set_KeyS9 = 0;    //é•¿æŒ‰è®¾ç½®é”®S9æ˜¯å¦è¢«æŒ‰ä¸‹æ ‡å¿—
  24          
  25          
  26          void KeyAction0(unsigned char keycode)  //æŒ‰é”®æŒ‰ä¸‹åŠ¨ä½œæ‰§è¡Œå¯¹åº”çš„æ“ä½œ,å‚æ•°ä¸ºæŒ‰é”®æ˜ å°„è¡¨ä
             -¸­çš„é”®å€¼
  27          {
  28   1              if(keycode == '4')
  29   1              {
  30   2                      MenuSelectContorlKeyS4();       //è¿›è¡Œèœå•é€‰æ‹©æ§åˆ¶
  31   2              }
  32   1              else if(keycode == '5')
  33   1              {
  34   2                      BackupDataMenuSelectKeyS5();    //è¿›è¡Œå›æ˜¾æ•°æ®èœå•é€‰æ‹©
  35   2              } 
  36   1              else if(keycode == '8')         
  37   1              {
  38   2                      TempParmModeAddKeyS8(); //è¿›è¡Œæ¸©åº¦å‚æ•°æ¨¡å¼å¢åŠ 
  39   2              }
  40   1              else if(keycode == '9') 
  41   1              {
  42   2                      TempParmModeReduceKeyS9();      //è¿›è¡Œæ¸©åº¦å‚æ•°æ¨¡å¼å‡å°‘
  43   2                      if(BackupMenuChange_S5 == 2)    //å¦‚æœå½“å‰å¤„äºæ—¶é—´å›æ˜¾ç•Œé¢          
  44   2                      {
  45   3                              flag_Long_Set_KeyS9 = 1;        //é•¿æŒ‰è®¾ç½®é”®S9è¢«æŒ‰ä¸‹,ç”¨äºè®°å½•S9é•¿æŒ‰æ—¶é—´
  46   3                      }
  47   2              }               
  48   1      }
  49          
  50          void KeyAction1(unsigned char keycode)  //æŒ‰é”®æ¾å¼€åŠ¨ä½œæ‰§è¡Œå¯¹åº”çš„æ“ä½œ,å‚æ•°ä¸ºæŒ‰é”®æ˜ å°„è¡¨ä
             -¸­çš„é”®å€¼
  51          {
  52   1              if(keycode == '9')
C51 COMPILER V9.60.0.0   KEY                                                               05/11/2023 22:29:08 PAGE 2   

  53   1              {
  54   2                      if(flag_Long_Set_KeyS9 == 1)    //å¦‚æœé•¿æŒ‰è®¾ç½®é”®S9è¢«æŒ‰ä¸‹
  55   2                      {
  56   3                              if(flag_Clear_Data == 1)        //å¦‚æœæ¸…é™¤æ•°æ®æ ‡å¿—è¢«ç½®ä½,å³é•¿æŒ‰è®¾ç½®é”®S9è¢«æŒ‰ä¸‹è¶…è¿‡2ç§’,åˆ
             -™æ¸…é™¤æ‰€æœ‰è§¦å‘æ•°æ®
  57   3                              {
  58   4                                      flag_Clear_Data = 0;    //æ¸…é™¤æ•°æ®æ ‡å¿—æ¸…é›¶,é˜²æ­¢é‡å¤æ¸…é™¤æ•°æ®
  59   4                                      AllTripDataInit();              //æ‰€æœ‰è§¦å‘æ•°æ®åˆå§‹åŒ–
  60   4                              }                         
  61   3                              flag_Long_Set_KeyS9 = 0;        //é•¿æŒ‰è®¾ç½®é”®S9è¢«æŒ‰ä¸‹æ ‡å¿—æ¸…é›¶,è¡¨é¢ç°åœ¨æŒ‰é”®S9æ²¡æœ‰è¢«æŒ‰ä¸‹
  62   3                      }
  63   2              }
  64   1      }
  65          
  66          void AllTripDataInit()  //æ‰€æœ‰è§¦å‘æ•°æ®åˆå§‹åŒ–
  67          {
  68   1              Trip_Cnt = 0;   //è§¦å‘æ¬¡æ•°æ¸…é›¶
  69   1              Temp_Data_Max = 0;      //æ¸©åº¦æ•°æ®æœ€å¤§å€¼æ¸…é›¶
  70   1              Temp_Data_Avg = 0;      //æ¸©åº¦æ•°æ®å¹³å‡å€¼æ¸…é›¶
  71   1              Hum_Data_Max = 0;       //æ¹¿åº¦æ•°æ®æœ€å¤§å€¼æ¸…é›¶
  72   1              Hum_Data_Avg = 0;       //æ¹¿åº¦æ•°æ®å¹³å‡å€¼æ¸…é›¶
  73   1              Ds1302_Last_Trip_Time[0] = 0x00;        //ä¸Šä¸€æ¬¡è§¦å‘æ—¶é—´æ¸…é›¶
  74   1              Ds1302_Last_Trip_Time[1] = 0x00;        
  75   1              Ds1302_Last_Trip_Time[2] = 0x00;
  76   1              flag_First_Tirp = 0;    //ç¬¬ä¸€æ¬¡è§¦å‘æ ‡å¿—æ¸…é›¶
  77   1              flag_First_Hum_Right = 0;               //ç¬¬ä¸€æ¬¡æ¹¿åº¦æ­£ç¡®æ ‡å¿—æ¸…é›¶
  78   1      }
  79          
  80          void MenuSelectContorlKeyS4()   //èœå•é€‰æ‹©æ§åˆ¶é”®
  81          {
  82   1              MenuModeSelect_S4++;    //èœå•æ¨¡å¼é€‰æ‹©åŠ 1
  83   1              if(MenuModeSelect_S4 > 2)       //å¦‚æœèœå•æ¨¡å¼é€‰æ‹©å¤§äº2
  84   1              {
  85   2                      MenuModeSelect_S4 = 0;  //èœå•æ¨¡å¼é€‰æ‹©æ¸…é›¶,èœå•æ¨¡å¼åªèƒ½é€‰æ‹©0,1,2ä¸‰ä¸ªç•Œé¢
  86   2                      Parm_Temp = Parm_Temp_Buf;      //åœ¨é€€å‡ºæ¸©åº¦å‚æ•°è®¾ç½®æ¨¡å¼æ—¶,å°†æ¸©åº¦å‚æ•°ç¼“å­˜èµ‹å€¼ç»™æ¸©åº¦å
             -‚æ•°,æ›´æ–°æ¸©åº¦å‚æ•°
  87   2              }
  88   1              if(MenuModeSelect_S4 == 0)      //å¦‚æœèœå•æ¨¡å¼é€‰æ‹©ä¸º0
  89   1              {
  90   2                      BackupMenuChange_S5 = 0;        //ä¿è¯åœ¨æ¯æ¬¡è¿›å…¥å›æ˜¾æ•°æ®æ¨¡å¼æ—¶,å›æ˜¾èœå•é€‰æ‹©ä¸º0
  91   2              }
  92   1      }
  93          
  94          void BackupDataMenuSelectKeyS5()        //å›æ˜¾æ•°æ®èœå•é€‰æ‹©
  95          {
  96   1              if(MenuModeSelect_S4 == 1)      //å¦‚æœå¤„äºå›æ˜¾æ•°æ®æ¨¡å¼
  97   1              {
  98   2                      BackupMenuChange_S5++;  //å›æ˜¾èœå•é€‰æ‹©åŠ 1
  99   2                      if(BackupMenuChange_S5 > 2)     //å¦‚æœå›æ˜¾èœå•é€‰æ‹©å¤§äº2
 100   2                      {
 101   3                              BackupMenuChange_S5 = 0;        //å›æ˜¾èœå•é€‰æ‹©æ¸…é›¶,å›æ˜¾èœå•åªèƒ½é€‰æ‹©0,1,2ä¸‰ä¸ªç•Œé¢
 102   3                      }               
 103   2              }       
 104   1      }
 105          
 106          
 107          void TempParmModeReduceKeyS9()  //æ¸©åº¦å‚æ•°å‡å°‘
 108          {
 109   1              if(MenuModeSelect_S4 == 2)      //å¦‚æœå¤„äºæ¸©åº¦å‚æ•°è®¾ç½®æ¨¡å¼
 110   1              {
 111   2                      if(Parm_Temp_Buf > 0)   //å¦‚æœæ¸©åº¦å‚æ•°å¤§äº0
 112   2                      {
C51 COMPILER V9.60.0.0   KEY                                                               05/11/2023 22:29:08 PAGE 3   

 113   3                              Parm_Temp_Buf -= 10;    //æ¸©åº¦å‚æ•°å‡10
 114   3                      }
 115   2              }
 116   1      }
 117          
 118          void TempParmModeAddKeyS8()     //æ¸©åº¦å‚æ•°å¢åŠ 
 119          {
 120   1              if(MenuModeSelect_S4 == 2)      //å¦‚æœå¤„äºæ¸©åº¦å‚æ•°è®¾ç½®æ¨¡å¼
 121   1              {
 122   2                      if(Parm_Temp_Buf < 990) //å¦‚æœæ¸©åº¦å‚æ•°å°äº990
 123   2                      {
 124   3                              Parm_Temp_Buf += 10;    //æ¸©åº¦å‚æ•°åŠ 10
 125   3                      }
 126   2              }
 127   1      }
 128          
 129          void KeyDriver()        //æŒ‰é”®é©±åŠ¨
 130          {
 131   1              unsigned char i,j;      //å¾ªç¯å˜é‡
 132   1              static unsigned char Key_Backup[2][2] = {       //ä¸Šä¸€æ¬¡æŒ‰é”®çŠ¶æ€,0è¡¨ç¤ºæŒ‰é”®æŒ‰ä¸‹,1è¡¨ç¤ºæŒ‰é”®æ¾å¼€
 133   1                      {1,1},{1,1}
 134   1              };
 135   1      
 136   1              for(i=0;i<2;i++)                //éå†æŒ‰é”®çŠ¶æ€è¡¨
 137   1              {
 138   2                      for(j=0;j<2;j++)        //éå†æŒ‰é”®çŠ¶æ€è¡¨
 139   2                      {
 140   3                              if(Key_Backup[i][j] != Key_Sta[i][j])   //åˆ¤æ–­æŒ‰é”®æ˜¯å¦æœ‰å˜åŒ–,æœ‰å˜åŒ–åˆ™æ‰§è¡ŒæŒ‰é”®åŠ¨ä½œ
 141   3                              {
 142   4                                      if(Key_Backup[i][j] == 1)       //å¦‚æœä¹‹å‰æŒ‰é”®æ˜¯æ¾å¼€çš„çŠ¶æ€,åˆ™è¯´æ˜è¿™æ¬¡æ˜¯æŒ‰é”®æŒ‰ä¸‹
 143   4                                      {
 144   5                                              KeyAction0(Key_Map[i][j]);      //æ‰§è¡ŒæŒ‰é”®æŒ‰ä¸‹åŠ¨ä½œ
 145   5                                      }
 146   4                                      else    //å¦‚æœä¹‹å‰æŒ‰é”®æ˜¯æŒ‰ä¸‹çš„çŠ¶æ€,åˆ™è¯´æ˜è¿™æ¬¡æ˜¯æŒ‰é”®æ¾å¼€
 147   4                                      {
 148   5                                              KeyAction1(Key_Map[i][j]);      //æ‰§è¡ŒæŒ‰é”®æ¾å¼€åŠ¨ä½œ
 149   5                                      }
 150   4                                      
 151   4                                      Key_Backup[i][j] = Key_Sta[i][j];       //æ›´æ–°æŒ‰é”®çŠ¶æ€
 152   4                              }
 153   3                      }
 154   2              }       
 155   1      }
 156          
 157          
 158          
 159          
 160          void KeyScan()  //æŒ‰é”®æ‰«æ
 161          {
 162   1              unsigned char i = 0;    
 163   1              static unsigned char Key_Out = 0;       //å½“å‰è¿›è¡Œæ‰«æçš„è¡Œ
 164   1              static unsigned char Key_Buff[2][2] = { //æŒ‰é”®ç¼“å­˜,0è¡¨ç¤ºæŒ‰é”®æŒ‰ä¸‹,1è¡¨ç¤ºæŒ‰é”®æ¾å¼€,ç”¨äºæ¶ˆæ
             -Š–
 165   1                      {0xFF,0xFF},{0xFF,0xFF}
 166   1              };
 167   1              
 168   1              Key_Buff[Key_Out][0] = (Key_Buff[Key_Out][0] << 1) | KEY_IN_0;  //ä¿å­˜æ­¤æ¬¡æ‰«æçš„æŒ‰é”®çŠ¶æ€,ç¬¬ä¸€
             -åˆ—ä¸ºKEY_IN_0,ç¬¬äºŒåˆ—ä¸ºKEY_IN_1
 169   1              Key_Buff[Key_Out][1] = (Key_Buff[Key_Out][1] << 1) | KEY_IN_1;
 170   1              
 171   1              for(i=0;i<2;i++)        //åˆ¤æ–­æŒ‰é”®çŠ¶æ€
 172   1              {
C51 COMPILER V9.60.0.0   KEY                                                               05/11/2023 22:29:08 PAGE 4   

 173   2                      if(Key_Buff[Key_Out][i] == 0x00)        //å¦‚æœæ¯è¡Œæ¯åˆ—çš„æŸä¸ªæŒ‰é”®è¿ç»­8æ¬¡æ‰«æéƒ½ä¸º0,åˆ™è¡¨ç¤ºæŒ‰
             -é”®æŒ‰ä¸‹
 174   2                      {
 175   3                              Key_Sta[Key_Out][i] = 0;        //æŒ‰é”®æŒ‰ä¸‹
 176   3                      }
 177   2                      else if(Key_Buff[Key_Out][i] == 0xFF)   //å¦‚æœæ¯è¡Œæ¯åˆ—çš„æŸä¸ªæŒ‰é”®è¿ç»­8æ¬¡æ‰«æéƒ½ä¸º1,åˆ™è¡¨ç
             -¤ºæŒ‰é”®æ¾å¼€
 178   2                      {
 179   3                              Key_Sta[Key_Out][i] = 1;        //æŒ‰é”®æ¾å¼€
 180   3                      }       
 181   2              }
 182   1              
 183   1              Key_Out++;      //ä¸‹ä¸€è¡Œè¿›è¡Œæ‰«æ
 184   1              Key_Out &= 0x01;        //Key_Outåªèƒ½ä¸º0æˆ–1
 185   1              
 186   1              switch(Key_Out) //é€‰æ‹©è¡Œ
 187   1              {
 188   2                      case 0: KEY_OUT_2 = 0; KEY_OUT_3 = 1; break;    //KEY_OUT_2ä¸º0,KEY_OUT_3ä¸º1,è¡¨ç¤ºæ‰«æç¬¬ä¸€è¡Œ
 189   2                      case 1: KEY_OUT_3 = 0; KEY_OUT_2 = 1; break;    //KEY_OUT_3ä¸º0,KEY_OUT_2ä¸º1,è¡¨ç¤ºæ‰«æç¬¬äºŒè¡Œ
 190   2                      default: break; 
 191   2              }
 192   1              
 193   1      }
 194          
 195          
 196          
 197          
 198          
 199          
 200          
 201          
 202          
 203          
 204          
 205          
 206          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    488    ----
   CONSTANT SIZE    =      4    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     19       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
