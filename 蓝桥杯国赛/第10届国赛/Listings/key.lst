C51 COMPILER V9.60.0.0   KEY                                                               06/01/2023 22:28:24 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE KEY
OBJECT MODULE PLACED IN .\Objects\key.obj
COMPILER INVOKED BY: E:\keil5\keil5\C51\BIN\C51.EXE Driver\key.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\User;.\Driver;.\Syste
                    -m;.\Config) DEBUG OBJECTEXTEND PRINT(.\Listings\key.lst) OBJECT(.\Objects\key.obj)

line level    source

   1          
   2          #include "key.h"
   3          
   4          
   5          
   6          unsigned char code Key_Map[2][2] = {
   7                  {'3','7'},
   8                  {'2','6'}
   9          };
  10          
  11          
  12          unsigned char Key_Sta[2][2] = {
  13                  {1,1},{1,1}
  14          };
  15          
  16          
  17          bit Menu_Mode = 0;
  18          
  19          unsigned char Menu_Data = 0;
  20          
  21          bit Menu_Parm = 0;
  22          
  23          
  24          bit flag_Key_Set = 0;
  25          
  26          unsigned int Parm_ChangCnt = 0;
  27          
  28          unsigned int ParmData_Temp = 3000;
  29          unsigned int ParmData_Temp_Buf = 3000;
  30          
  31          unsigned int ParmData_Distence = 35;
  32          unsigned char ParmData_Distence_Buf = 35;
  33          
  34          
  35          
  36          void KeyAction0(unsigned char keycode)
  37          {
  38   1              if(keycode == '3')
  39   1              {
  40   2                      flag_Key_Set = 1;
  41   2              }
  42   1              else if(keycode == '2')
  43   1              {
  44   2                      flag_Key_Set = 1;               
  45   2              }
  46   1              else if(keycode == '6')
  47   1              {
  48   2                      if(Menu_Mode == 1)
  49   2                      {
  50   3                              if(Menu_Parm == 0)
  51   3                              {
  52   4                                      if(ParmData_Temp_Buf > 200)
  53   4                                      {
  54   5                                              ParmData_Temp_Buf -= 200;
C51 COMPILER V9.60.0.0   KEY                                                               06/01/2023 22:28:24 PAGE 2   

  55   5                                      }
  56   4                                      else
  57   4                                      {
  58   5                                              ParmData_Temp_Buf = 0;
  59   5                                      }
  60   4                              }
  61   3                              else
  62   3                              {
  63   4                                      if(ParmData_Distence_Buf > 5)
  64   4                                      {
  65   5                                              ParmData_Distence_Buf -= 5;
  66   5                                      }
  67   4                                      else
  68   4                                      {
  69   5                                              ParmData_Distence_Buf = 0;
  70   5                                      }
  71   4                              }
  72   3                      }
  73   2              }
  74   1              else if(keycode == '7')
  75   1              {
  76   2                      if(Menu_Mode == 1)
  77   2                      {
  78   3                              if(Menu_Parm == 0)
  79   3                              {
  80   4                                      ParmData_Temp_Buf += 200;
  81   4                                      if(ParmData_Temp_Buf > 9900)
  82   4                                      {
  83   5                                              ParmData_Temp_Buf = 9900;
  84   5                                      }
  85   4                              }
  86   3                              else
  87   3                              {
  88   4                                      ParmData_Distence_Buf += 5;
  89   4                                      if(ParmData_Distence_Buf > 99)
  90   4                                      {
  91   5                                              ParmData_Distence_Buf = 99;
  92   5                                      }
  93   4                              }
  94   3                      }                               
  95   2              }       
  96   1      }
  97          
  98          
  99          void KeyAction1(unsigned char keycode)
 100          {
 101   1              unsigned char Data_Buf = 0;
 102   1              
 103   1              if(keycode == '3')
 104   1              {
 105   2                      flag_Key_Set = 0;
 106   2                      if(Key_SetTime < 1000)
 107   2                      {
 108   3                              if(Menu_Mode == 1)
 109   3                              {
 110   4                                      if((ParmData_Temp_Buf != ParmData_Temp) || (ParmData_Distence_Buf != ParmData_Distence))
 111   4                                      {
 112   5                                              Parm_ChangCnt++;
 113   5                                              Data_Buf = (unsigned char)(Parm_ChangCnt & 0x0F); 
 114   5                                              EEPROM_WriteData(PARM_CNT_ADDR_LOW,Data_Buf);
 115   5                                              Data_Buf = (unsigned char)(Parm_ChangCnt >> 8);
 116   5                                              EEPROM_WriteData(PARM_CNT_ADDR_HIGH,Data_Buf);                                          
C51 COMPILER V9.60.0.0   KEY                                                               06/01/2023 22:28:24 PAGE 3   

 117   5                                      }
 118   4                                      ParmData_Temp = ParmData_Temp_Buf;
 119   4                                      ParmData_Distence = ParmData_Distence_Buf;
 120   4                              }
 121   3                              Menu_Mode = ~Menu_Mode;
 122   3                              Menu_Data = 0;
 123   3                              Menu_Parm = 0;
 124   3                      }
 125   2                      else
 126   2                      {
 127   3                              DAC_Mode = ~DAC_Mode;
 128   3                      }
 129   2                      Key_SetTime = 0;
 130   2              }
 131   1              else if(keycode == '2')
 132   1              {
 133   2                      flag_Key_Set = 0;
 134   2                      if(Key_SetTime < 1000)
 135   2                      {
 136   3                              if(Menu_Mode == 0)
 137   3                              {
 138   4                                      Menu_Data++;
 139   4                                      if(Menu_Data > 2)
 140   4                                      {
 141   5                                              Menu_Data = 0;
 142   5                                      }
 143   4                              }
 144   3                              else
 145   3                              {
 146   4                                      Menu_Parm = ~Menu_Parm;
 147   4                              }
 148   3                      }
 149   2                      else
 150   2                      {
 151   3                              Parm_ChangCnt = 0;
 152   3                              Data_Buf = (unsigned char)(Parm_ChangCnt & 0x0F); 
 153   3                              EEPROM_WriteData(PARM_CNT_ADDR_LOW,Data_Buf);
 154   3                              Data_Buf = (unsigned char)(Parm_ChangCnt >> 8);
 155   3                              EEPROM_WriteData(PARM_CNT_ADDR_HIGH,Data_Buf);                                  
 156   3                      }
 157   2                      Key_SetTime = 0;                
 158   2              }
 159   1      
 160   1              
 161   1      }
 162          
 163          void KeyDriver()
 164          {
 165   1              unsigned char i,j;
 166   1              static unsigned char Key_Backup[2][2] = {
 167   1                      {1,1},{1,1}
 168   1              };
 169   1              
 170   1              for(i=0;i<2;i++)
 171   1              {
 172   2                      for(j=0;j<2;j++)
 173   2                      {
 174   3                              if(Key_Backup[i][j] != Key_Sta[i][j])
 175   3                              {
 176   4                                      if(Key_Backup[i][j] == 1)
 177   4                                      {
 178   5                                              KeyAction0(Key_Map[i][j]);
C51 COMPILER V9.60.0.0   KEY                                                               06/01/2023 22:28:24 PAGE 4   

 179   5                                      }
 180   4                                      else
 181   4                                      {
 182   5                                              KeyAction1(Key_Map[i][j]);
 183   5                                      }
 184   4                                      
 185   4                                      Key_Backup[i][j] = Key_Sta[i][j];
 186   4                              }
 187   3                      }
 188   2              }
 189   1      }
 190          
 191          
 192          
 193          
 194          
 195          void KeyScan()
 196          {
 197   1              unsigned char i = 0;
 198   1              static unsigned char Key_Out = 0;
 199   1              static unsigned char Key_Buff[2][2] = {
 200   1                      {0xFF,0xFF},{0xFF,0xFF}
 201   1              };
 202   1              
 203   1              Key_Buff[Key_Out][0] = (Key_Buff[Key_Out][0] << 1) | KEY_IN_2;
 204   1              Key_Buff[Key_Out][1] = (Key_Buff[Key_Out][1] << 1) | KEY_IN_3;
 205   1      
 206   1              for(i=0;i<2;i++)
 207   1              {
 208   2                      if(Key_Buff[Key_Out][i] == 0x00)
 209   2                      {
 210   3                              Key_Sta[Key_Out][i] = 0;
 211   3                      }
 212   2                      else if(Key_Buff[Key_Out][i] == 0xFF)
 213   2                      {
 214   3                              Key_Sta[Key_Out][i] = 1;
 215   3                      }
 216   2              }
 217   1              
 218   1              Key_Out++;
 219   1              Key_Out &= 0x01;
 220   1              
 221   1              switch(Key_Out)
 222   1              {
 223   2                      case 0: KEY_OUT_2 = 0; KEY_OUT_3 = 1; break;
 224   2                      case 1: KEY_OUT_3 = 0; KEY_OUT_2 = 1; break;
 225   2                      default: break;
 226   2              }
 227   1              
 228   1      }
 229          
 230          
 231          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    599    ----
   CONSTANT SIZE    =      4    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     23       4
   IDATA SIZE       =   ----    ----
C51 COMPILER V9.60.0.0   KEY                                                               06/01/2023 22:28:24 PAGE 5   

   BIT SIZE         =      3    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
