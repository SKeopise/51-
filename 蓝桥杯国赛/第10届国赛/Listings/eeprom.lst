C51 COMPILER V9.60.0.0   EEPROM                                                            06/01/2023 22:28:24 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE EEPROM
OBJECT MODULE PLACED IN .\Objects\eeprom.obj
COMPILER INVOKED BY: E:\keil5\keil5\C51\BIN\C51.EXE Driver\eeprom.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\User;.\Driver;.\Sy
                    -stem;.\Config) DEBUG OBJECTEXTEND PRINT(.\Listings\eeprom.lst) OBJECT(.\Objects\eeprom.obj)

line level    source

   1          #include "eeprom.h"
   2          
   3          #define FIRST_ADDR 0x77
   4          #define FIRST_DATA 0x66
   5          
   6          
   7          
   8          void FirstRead_EEPROM()
   9          {
  10   1              unsigned char Data_Buf = 0;
  11   1              
  12   1              EEPROM_ReadData(FIRST_ADDR,&Data_Buf);
  13   1              if(Data_Buf != FIRST_DATA)
  14   1              {
  15   2                      EEPROM_WriteData(FIRST_ADDR,FIRST_DATA);
  16   2                      Data_Buf = (unsigned char)(Parm_ChangCnt & 0x0F); 
  17   2                      EEPROM_WriteData(PARM_CNT_ADDR_LOW,Data_Buf);
  18   2                      Data_Buf = (unsigned char)(Parm_ChangCnt >> 8);
  19   2                      EEPROM_WriteData(PARM_CNT_ADDR_HIGH,Data_Buf);          
  20   2              }
  21   1              else
  22   1              {
  23   2                      EEPROM_ReadData(PARM_CNT_ADDR_HIGH,&Data_Buf);
  24   2                      Parm_ChangCnt = Data_Buf;
  25   2                      Parm_ChangCnt <<= 8;
  26   2                      EEPROM_ReadData(PARM_CNT_ADDR_LOW,&Data_Buf);
  27   2                      Parm_ChangCnt |= Data_Buf;
  28   2              }
  29   1      }
  30          
  31          
  32          
  33          void Delay5ms()         //@12.000MHz
  34          {
  35   1              unsigned char i, j;
  36   1      
  37   1              i = 59;
  38   1              j = 90;
  39   1              do
  40   1              {
  41   2                      while (--j);
  42   2              } while (--i);
  43   1      }
  44          
  45          
  46          
  47          void EEPROM_ReadData(unsigned char addr,unsigned char *dat)
  48          {
  49   1              I2CStart();
  50   1              I2CSendByte(0xA0);
  51   1              I2CWaitAck();
  52   1              I2CSendByte(addr);
  53   1              I2CWaitAck();
  54   1              
C51 COMPILER V9.60.0.0   EEPROM                                                            06/01/2023 22:28:24 PAGE 2   

  55   1              I2CStart();
  56   1              I2CSendByte(0xA1);
  57   1              I2CWaitAck();   
  58   1              
  59   1              *dat = I2CReceiveByte();
  60   1              I2CSendAck(1);
  61   1              I2CStop();
  62   1      }
  63          
  64          
  65          void EEPROM_WriteData(unsigned char addr,unsigned char dat)
  66          {
  67   1              I2CStart();
  68   1              I2CSendByte(0xA0);
  69   1              I2CWaitAck();
  70   1              I2CSendByte(addr);
  71   1              I2CWaitAck();
  72   1              I2CSendByte(dat);
  73   1              I2CWaitAck();
  74   1              I2CStop();      
  75   1              
  76   1              Delay5ms();
  77   1      }
  78          
  79          
  80          
  81          
  82          
  83          
  84          
  85          
  86          
  87          
  88          
  89          
  90          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    188    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       7
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
